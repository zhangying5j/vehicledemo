webpackJsonp([117],{Ugw0:function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=i("Dd8w"),a=i.n(n),l=i("NYxO"),o=i("P0XF"),r={name:"Add",components:{BaseTable:function(){return i.e(120).then(i.bind(null,"ss0d"))},QueryForm:function(){return i.e(123).then(i.bind(null,"Hb8j"))}},data:function(){return{indexDialogShow:!1,targetFeeRateFlag:!1,targetChangeCostRateFlag:!1,tempcolumns:[{prop:"subInstitution",label:"机构",width:160},{prop:"type",label:"预算周期",width:100},{prop:"timeSlot",label:"预算时间段",width:120},{prop:"channel",label:"预算渠道",width:120},{prop:"targetPremium",label:"目标保费收入",width:140,isEdit:!1,type:"input"},{prop:"targetCostRate",label:"目标保单成本率 + ",width:180,isShow:!1,children:[{prop:"targetPayRate",label:"目标保单赔付率",width:140,isEdit:!1,type:"input"},{prop:"targetExpPayRate",label:"目标理赔费用率",width:140},{prop:"targetFeeRate",label:"目标保单费用率",width:140},{prop:"targetCostRate",label:"合计",width:140}]},{prop:"targetChangeCostRate",label:"目标变动成本率 + ",width:180,isShow:!1,children:[{prop:"targetPayRate",label:"目标保单赔付率",width:140,isEdit:!1,type:"input"},{prop:"targetExpPayRate",label:"目标理赔费用率",width:140},{prop:"saleRate",label:"销售费用率",width:140},{prop:"targetChangeCostRate",label:"合计",width:140}]},{prop:"targetPayRate",label:"目标保单赔付率",width:140,isEdit:!1,type:"input"},{prop:"targetExpPayRate",label:"目标理赔费用率 + ",width:180,isShow:!1,children:[{prop:"targetDirectExpPayRate",label:"目标直接理赔费用率",width:140,isEdit:!1,type:"input"},{prop:"targetIndirectExpPayRate",label:"目标间接理赔费用率",width:140,isEdit:!1,type:"input"},{prop:"targetExpPayRate",label:"合计",width:140}]},{prop:"targetFeeRate",label:"目标保单费用率 + ",width:180,isShow:!1,children:[{prop:"saleRate",label:"销售费用率 + ",width:180,isShow:!1,children:[{prop:"serverFeeRate",label:"手续费率",width:140,isEdit:!1,type:"input"},{prop:"salePersonRate",label:"销售人力薪酬率",width:140,isEdit:!1,type:"input"},{prop:"saleDriverFeeRate",label:"营销推动费用率",width:140,isEdit:!1,type:"input"}]},{prop:"fixedFeeRate",label:"固定费用率",width:140,isEdit:!1,type:"input"},{prop:"otherFeeRate",label:"其他费用率",width:140,isEdit:!1,type:"input"},{prop:"targetFeeRate",label:"合计",width:140}]},{prop:"lossBizRatio",label:"亏损业务占比",width:140,isEdit:!1,type:"input"},{prop:"lossBizPremium",label:"严重亏损业务保费规模",width:140,isEdit:!1,type:"input"}],impDialogVisible:!1,budget:{formulateInstitution:"00000",type:"year",channel:"all",timeSlot:"2018",version:"",bore:"policy",productType:"all"},rules:{formulateInstitution:[{required:!0,trigger:"change",message:"预算制定机构不能为空"}],type:[{required:!0,trigger:"change",message:"预算类型不能为空"}],channel:[{required:!0,trigger:"change",message:"预算渠道不能为空"}],timeSlot:[{required:!0,trigger:"change",message:"预算时间段不能为空"}],productType:[{required:!0,trigger:"change",message:"业务分类不能为空"}]},editFlag:!1,indexList:[{code:"targetPremium",name:"保费收入"},{code:"targetCostRate",name:"保单成本率"},{code:"targetChangeCostRate",name:"变动成本率"},{code:"targetPayRate",name:"保单赔付率"},{code:"targetExpPayRate",name:"理赔费用率"},{code:"targetFeeRate",name:"保单费用率"},{code:"targetDirectExpPayRate",name:"直接理赔费用率"},{code:"targetIndirectExpPayRate",name:"间接理赔费用率"},{code:"saleRate",name:"销售费用率"},{code:"fixedFeeRate",name:"固定费用率"},{code:"otherFeeRate",name:"其他费用率"},{code:"serverFeeRate",name:"手续费率"},{code:"salePersonRate",name:"销售人力薪酬率"},{code:"saleDriverFeeRate",name:"营销推动费用率"}],diyindex:{id:"",diyindexnm:"",indexnm:"",term:"",val:""},diyindexlist:[{id:"1",diyindexnm:"亏损业务",indexnm:"保单成本率",indexcd:"targetCostRate",term:"大于",val:"100%"},{id:"2",diyindexnm:"严重亏损业务",indexnm:"保单成本率",indexcd:"targetCostRate",term:"大于",val:"110%"}]}},watch:{orgCd:function(){this.$store.commit("SET_ADD_DATA",[])}},computed:a()({},Object(l.d)({tableHeader:function(e){return e.app.tableHeader},addData:function(e){return e.budget.addData},formData:function(e){return e.budget.formData}}),{orgCd:function(){return this.budget.formulateInstitution},isLv1Org:function(){return this.orgCd.endsWith("00000")},isLv2Org:function(){return!this.isLv1Org&&this.orgCd.endsWith("000")},isLv3Org:function(){return this.orgCd&&!this.orgCd.endsWith("00")},timeSlots:function(){var e=this.budget.type+"";return"month"===e?this.resetTime("201801"):"year"===e&&this.resetTime("2018"),[]}}),methods:{importData:function(){var e=this;if("01000"===this.budget.formulateInstitution){var t=this.$createElement;this.$msgbox({title:"提示",message:t("p",null,[t("p",{style:"color: red"},"预算目标不得低于总公司为本机构制定的预算目标!"),t("p",{style:"color: red"},"请确保导入的数据符合此规定!"),t("p",{style:"color: red"},"确定继续导入操作吗?")]),showCancelButton:!0,confirmButtonText:"确定",cancelButtonText:"取消",type:"info"}).then(function(){e.impDialogVisible=!0}).catch(function(){})}else this.impDialogVisible=!0},hearclick:function(e,t){if(e.label.includes("+")&&(console.log("==========="),this.tempcolumns.forEach(function(t){t.label===e.label&&(t.label=t.label.replace("+","-"))}),"销售费用率 + "===e.label&&this.tempcolumns.forEach(function(t){void 0!==t.children&&t.children.forEach(function(t){t.label===e.label&&(t.label=t.label.replace("+","-"))})})),e.label.includes("-")&&(console.log("==========="),this.tempcolumns.forEach(function(t){t.label===e.label&&(t.label=t.label.replace("-","+"))}),"销售费用率 - "===e.label&&this.tempcolumns.forEach(function(t){void 0!==t.children&&t.children.forEach(function(t){t.label===e.label&&(t.label=t.label.replace("-","+"))})})),1===e.level){var i=this.tempcolumns.findIndex(function(t){return t.prop===e.property});void 0!==this.tempcolumns[i].isShow&&(this.tempcolumns[i].isShow=!this.tempcolumns[i].isShow)}else if(2===e.level){this.tempcolumns.filter(function(e){return e.children}).filter(function(e){return"targetChangeCostRate"===e.prop||"targetFeeRate"===e.prop}).forEach(function(e){e.children.forEach(function(e){e.isShow=!e.isShow})})}},edit:function(){this.editFlag=!0,this.tempcolumns.forEach(function(e){void 0!==e.isEdit&&(e.isEdit=!0),void 0!==e.children&&e.children.forEach(function(e){void 0!==e.isEdit&&(e.isEdit=!0),void 0!==e.children&&e.children.forEach(function(e){void 0!==e.isEdit&&(e.isEdit=!0)})})})},save:function(){this.editFlag=!1,this.tempcolumns.forEach(function(e){void 0!==e.isEdit&&(e.isEdit=!1),void 0!==e.children&&e.children.forEach(function(e){void 0!==e.isEdit&&(e.isEdit=!1),void 0!==e.children&&e.children.forEach(function(e){void 0!==e.isEdit&&(e.isEdit=!1)})})})},approval:function(){var e=this,t=this.$createElement;this.$msgbox({title:"提示",message:t("p",null,[t("p",null,"①4个季度累计保费收入预算值小于年度保费收入预算值!"),t("p",null,"②4个季度预算加权合计经营成本率大于年度预算经营成本率!"),t("p",{style:"color: blue"},"确定提交审批吗?")]),showCancelButton:!0,confirmButtonText:"确定",cancelButtonText:"取消",type:"info"}).then(function(){e.$message({type:"success",message:"下发成功!"})}).catch(function(){})},getSummaries:function(e){var t=e.columns,i=e.data,n=[];return i.length>0&&t.forEach(function(e,t){if(0!==t)if(1!==t)if(2!==t)if(3!==t)if(4!==t){var a=i.map(function(i){return 5===t?Number(i[e.property]):Number(i[e.property].replace("%",""))});a.every(function(e){return isNaN(e)})?n[t]="N/A":(n[t]=a.reduce(function(e,t){var i=Number(t);return isNaN(i)?e:e+t},0),5===t?n[t]=n[t].toFixed(2):t>5&&(n[t]/=i.length,n[t]=n[t].toFixed(2),n[t]+="%"))}else n[t]=i[0].productType;else n[t]=i[0].timeSlot;else n[t]=i[0].channel;else n[t]=i[0].type;else n[t]="全国总计:"}),n},download:function(){var e=this;this.$confirm("确定下载预算模板?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"info"}).then(function(){e.$message({type:"success",message:"预算模板下载成功!"})}).catch(function(){})},upload:function(){var e=this;this.impDialogVisible=!1,this.$message({type:"success",message:"导入成功!"});var t=this.formData.types.find(function(t){return t.code===e.budget.type}),i=t.timeSlots.find(function(t){return t.code===e.budget.timeSlot});this.$store.dispatch("uploadData",{formulateInstitution:this.budget.formulateInstitution,type:t.name,timeSlot:i.name})},exportData:function(){var e=this;this.$confirm("确定导出预算数据吗?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"info"}).then(function(){e.$message({type:"success",message:"预算数据导出成功!"})}).catch(function(){})},queryList:function(e,t,i){var n=this;return e.forEach(function(e){e.children&&e.prop===t?i=e.children:e.children&&e.children.length>0&&n.queryList(e.children,t,[])}),i},changeTableData:function(e,t,i){if(t){var n=0;this.queryList(this.tempcolumns,t,[]).forEach(function(t){"合计"!==t.label?n+=Number(e[t.prop]):(e[t.prop]=n.toFixed(2),n=0)})}},addDiyIndex:function(){var e=Object(o.a)();this.diyindex.id=e,this.diyindex.diyindexnm="",this.diyindex.indexnm="",this.diyindex.term="",this.diyindex.val="",this.indexDialogShow=!0},removediyindex:function(){var e=this;this.$confirm("确定删除该定义指标吗?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"info"}).then(function(){var t=e.diyindexlist.findIndex(function(t){return t.id===e.diyindex.id});e.diyindexlist.splice(t,1),e.$message({type:"success",message:"删除成功!"})}).catch(function(){})},detaildiyindex:function(e){this.diyindex=this.diyindexlist.find(function(t){return t.id===e}),this.indexDialogShow=!0},commitIndex:function(){var e=this,t=this.diyindexlist.findIndex(function(t){return t.id===e.diyindex.id});-1!==t?this.diyindexlist.splice(t,1,this.diyindex):this.diyindexlist.push(this.diyindex),this.indexDialogShow=!1}}},s={render:function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",{staticClass:"data"},[i("div",{staticClass:"form"},[i("query-form",{ref:"addFrom",attrs:{budget:e.budget,rules:e.rules}})],1),e._v(" "),i("div",{staticClass:"table"},[i("div",{staticClass:"option"},[i("el-button",{directives:[{name:"show",rawName:"v-show",value:!e.isLv3Org,expression:"!isLv3Org"}],attrs:{type:"primary",plain:""},on:{click:e.download}},[e._v("下载预算模板")]),e._v(" "),i("el-button",{directives:[{name:"show",rawName:"v-show",value:!e.isLv3Org,expression:"!isLv3Org"}],attrs:{type:"primary",plain:""},on:{click:e.importData}},[e._v("导入预算数据")]),e._v(" "),i("el-button",{attrs:{type:"primary",plain:""},on:{click:e.exportData}},[e._v("导出预算数据")]),e._v(" "),i("el-button",{directives:[{name:"show",rawName:"v-show",value:!e.editFlag,expression:"!editFlag"}],attrs:{type:"primary",plain:""},on:{click:e.edit}},[e._v("编辑")]),e._v(" "),i("el-button",{directives:[{name:"show",rawName:"v-show",value:e.editFlag,expression:"editFlag"}],attrs:{type:"primary",plain:""},on:{click:e.save}},[e._v("保存")]),e._v(" "),i("el-button",{directives:[{name:"show",rawName:"v-show",value:e.isLv2Org,expression:"isLv2Org"}],attrs:{type:"primary",plain:""},on:{click:e.approval}},[e._v("下发")]),e._v(" "),i("el-button",{directives:[{name:"show",rawName:"v-show",value:e.isLv3Org,expression:"isLv3Org"}],attrs:{type:"primary",plain:""},on:{click:function(t){e.$store.dispatch("uploadData")}}},[e._v("查看")]),e._v(" "),i("el-button",{directives:[{name:"show",rawName:"v-show",value:e.isLv3Org,expression:"isLv3Org"}],attrs:{type:"primary",plain:""},on:{click:e.approval}},[e._v("确认")])],1),e._v(" "),i("div",{staticClass:"tag"},[e._l(e.diyindexlist,function(t){return i("el-tag",{key:t.id,attrs:{type:"primary",closable:""},on:{close:function(i){e.removediyindex(t.id)}},nativeOn:{click:function(i){e.detaildiyindex(t.id)}}},[e._v("\n        "+e._s(t.diyindexnm)+": "+e._s(t.indexnm)+e._s(t.term)+e._s(t.val)+"\n      ")])}),e._v(" "),i("el-button",{attrs:{size:"small",plain:"",icon:"el-icon-plus"},on:{click:e.addDiyIndex}},[e._v("指标定义")])],2),e._v(" "),i("el-table",{attrs:{stripe:"",border:"","header-cell-style":e.tableHeader,"max-height":"550",data:e.addData},on:{"header-click":e.hearclick}},e._l(e.tempcolumns,function(t,n){return i("el-table-column",{key:Math.random()+n,attrs:{"header-align":"center",prop:t.prop,label:t.label,width:t.width,align:t.align?t.align:"center"},scopedSlots:e._u([{key:"default",fn:function(n){return[t.isEdit&&"input"===t.type?i("el-input",{attrs:{size:"small"},on:{input:function(t){e.changeTableData(n.row)}},model:{value:n.row[t.prop],callback:function(i){e.$set(n.row,t.prop,i)},expression:"scope.row[column.prop]"}}):i("span",[e._v(e._s(n.row[t.prop]))])]}}])},[t.isShow?e._l(t.children,function(n,a){return i("el-table-column",{key:Math.random()+a,attrs:{"header-align":"center",prop:n.prop,"min-width":n.width,label:n.label,align:n.align?n.align:"center"},scopedSlots:e._u([{key:"default",fn:function(a){return[n.isEdit&&"input"===n.type?i("el-input",{attrs:{size:"small"},on:{input:function(i){e.changeTableData(a.row,t.prop,n.prop)}},model:{value:a.row[n.prop],callback:function(t){e.$set(a.row,n.prop,t)},expression:"scope.row[subColumn.prop]"}}):i("span",[e._v(e._s(a.row[n.prop]))])]}}])},[n.isShow?e._l(n.children,function(t,a){return i("el-table-column",{key:Math.random()+a,attrs:{"header-align":"center",prop:t.prop,"min-width":t.width,label:t.label,align:t.align?t.align:"center"},scopedSlots:e._u([{key:"default",fn:function(a){return[t.isEdit&&"input"===t.type?i("el-input",{attrs:{size:"small"},on:{input:function(i){e.changeTableData(a.row,n.prop,t.prop)}},model:{value:a.row[t.prop],callback:function(i){e.$set(a.row,t.prop,i)},expression:"scope.row[thirdColumn.prop]"}}):i("span",[e._v(e._s(a.row[t.prop]))])]}}])})}):e._e()],2)}):e._e()],2)})),e._v(" "),i("el-dialog",{attrs:{title:"导入预算数据",visible:e.impDialogVisible,width:"40%"},on:{"update:visible":function(t){e.impDialogVisible=t}}},[i("el-upload",{attrs:{action:"https://jsonplaceholder.typicode.com/posts/",multiple:""}},[i("el-button",{attrs:{size:"small",type:"primary"}},[e._v("选择文件")]),e._v(" "),i("div",{staticClass:"el-upload__tip",attrs:{slot:"tip"},slot:"tip"},[e._v("只能上传excel文件")])],1),e._v(" "),i("div",{staticClass:"dialog-footer",staticStyle:{"text-align":"center"},attrs:{slot:"footer"},slot:"footer"},[i("el-button",{attrs:{type:"primary",plain:""},on:{click:e.upload}},[e._v("导入")]),e._v(" "),i("el-button",{attrs:{type:"primary",plain:""},on:{click:function(t){e.impDialogVisible=!1}}},[e._v("关闭")])],1)],1),e._v(" "),i("el-dialog",{attrs:{title:"指标定义",visible:e.indexDialogShow,width:"30%"},on:{"update:visible":function(t){e.indexDialogShow=t}}},[i("div",{staticClass:"form"},[i("el-form",{attrs:{size:"small",model:e.diyindex}},[i("el-form-item",{attrs:{label:"定义指标名称",prop:"diyindexnm"}},[i("el-input",{attrs:{size:"medium"},model:{value:e.diyindex.diyindexnm,callback:function(t){e.$set(e.diyindex,"diyindexnm",t)},expression:"diyindex.diyindexnm"}})],1),e._v(" "),i("el-form-item",{attrs:{label:"选择指标",prop:"indexnm"}},[i("el-select",{attrs:{placeholder:"请选择指标",size:"medium"},model:{value:e.diyindex.indexnm,callback:function(t){e.$set(e.diyindex,"indexnm",t)},expression:"diyindex.indexnm"}},e._l(e.indexList,function(e){return i("el-option",{key:e.code,attrs:{value:e.name,label:e.name}})}))],1),e._v(" "),i("el-form-item",{attrs:{label:"条件",prop:"term"}},[i("el-select",{attrs:{size:"medium"},model:{value:e.diyindex.term,callback:function(t){e.$set(e.diyindex,"term",t)},expression:"diyindex.term"}},[i("el-option",{attrs:{value:"大于",label:"大于"}}),e._v(" "),i("el-option",{attrs:{value:"等于",label:"等于"}}),e._v(" "),i("el-option",{attrs:{value:"小于",label:"小于"}})],1)],1),e._v(" "),i("el-form-item",{attrs:{label:"条件值",prop:"val"}},[i("el-input",{attrs:{size:"medium"},model:{value:e.diyindex.val,callback:function(t){e.$set(e.diyindex,"val",t)},expression:"diyindex.val"}})],1),e._v(" "),i("el-form-item",[i("el-button",{attrs:{plain:"",size:"small",type:"primary"},on:{click:e.commitIndex}},[e._v("确定")])],1)],1)],1)])],1)])},staticRenderFns:[]},d=i("VU/8")(r,s,!1,null,null,null);t.default=d.exports}});